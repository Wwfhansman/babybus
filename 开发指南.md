# 开发指南（Novel → Comic）

本文档面向参与开发的同学，目标是让你在尽可能短的时间内跑通“输入一段文字 → 生成若干漫画页面 → 导出”的最小可行版本（MVP）。

## 一、开发顺序（建议）
1) 环境搭建与跑通“空框架”
- 安装：Python 3.10+、Node.js 22+、Git。
- 后端：`pip install -r requirements.txt`，启动 `uvicorn app.main:app --host 127.0.0.1 --port 8787 --reload`。
- 前端：进入 `desktop/electron` 执行 `npm install && npm run dev`（electron-vite 热更新）。
- 联调：主进程通过 IPC 调用后端 API；渲染器仅调用受限接口（preload 暴露）。

2) 后端 MVP（FastAPI）
- 接口：分词/句子切分 → 镜头拆解 → 场景/角色生成 → 布局与导出。
- 存储：本地 `outputs/` 保存生成的图片与 json；后续可接入云存储。

3) 前端 MVP（Electron + React 桌面）
- 文件导入：读取 `.txt`/`.md`/`.docx`，分段展示与编辑。
- 参数面板：角色/场景/风格/布局等参数可编辑，支持预设模板。
- 生成流程：调用后端接口显示进度（任务列表/状态/重试）。
- 预览与导出：页面预览（分页/缩略图），导出 PNG/JPG/PDF。

## 二、项目结构（建议）
```
project/
  desktop/      # Electron + React 客户端工程
  backend/      # Python 服务（FastAPI/云 API 调用编排）
  configs/      # 云服务配置（本机 .env，不入库敏感信息）
  data/         # 输入与中间数据
  outputs/      # 生成图片/音频/导出文档
  docs/         # 需求/架构/开发文档
```
- 命名规范：
  - 文件与文件夹使用英文与下划线（如 `comic_export_service.py`）。
  - 资源按项目/小说/章节分层：`outputs/<novel>/<chapter>/...`。

## 三、环境与运行
- 后端（本机）：`uvicorn app.main:app --host 127.0.0.1 --port 8787 --reload`
- Electron + React：在 `desktop/electron` 执行 `npm run dev` 启动主进程与渲染器（Vite dev server）。
- 打包（Windows）：`npm run build:win`（electron-builder 生成安装包/绿色版）。

## 四、后端 API 草案（MVP）
- `POST /parse/text`：输入文本，返回分段与关键元素。
- `POST /storyboard`：生成镜头脚本（分镜）。
- `POST /image/generate`：生成角色/场景图像（AIGC）。
- `POST /layout/apply`：将图像与文本排版为页面。
- `POST /export`：导出 PNG/JPG/PDF。

## 五、前端实现（关键点）
- 框架与依赖（建议）：`react`、`react-router-dom`、`zustand`（或 `redux-toolkit`）、`axios`、`immer`、`zod`、`antd`。
- 进程与能力：主进程实现文件读写/窗口管理/调用 Python；`preload` 注入受限 API；渲染器通过 `ipcRenderer.invoke` 调用。
- 状态与数据：任务队列（生成/重试/取消）、参数持久化（`localStorage`/文件）、导出历史与回收站。
- 安全：`contextIsolation: true`、`nodeIntegration: false`、IPC 白名单、参数校验与路径白名单。

## 六、文本解析与元素抽取
- 预处理：语言检测、分段、去除无效字符。
- 元素抽取：角色/场景/情绪/动作等关键元素抽取。

## 七、分镜与画面生成
- 分镜：根据文本元素生成镜头脚本（画面/对白/旁白）。
- 画面生成：调用 AIGC（角色/场景），支持风格预设与一致性约束。

## 八、排版与导出
- 排版：模板化布局（网格/多栏/对话框/字幕），支持快捷编辑。
- 导出：页面（PNG/JPG）、书册（PDF）。

## 九、质量、性能与稳定
- 一致性：角色/场景设定固定；命名规范与资源管理。
- 性能：
  - 前端：长任务通过 Web Worker/IPC 下放到主进程或后端；渲染器保持响应。
  - 后端：任务并发与队列；缓存策略；大对象按需加载。
- 稳定：异常捕获与重试；进度回滚与断点续跑；日志记录。

## 十、测试与验收
- 单元测试：后端（Python）；前端（React 组件与 hooks）。
- 联调测试：端到端跑通从导入到导出；异常场景（网络错误/生成失败）。

## 十一、对新同学的提醒
- 谨慎保存：输入文本与生成结果默认存储在 `outputs/`，注意隐私。
- 避免在渲染器直接访问 Node 能力；一律走 IPC 白名单与参数校验。